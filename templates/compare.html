<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
            
</head>
<body>
    <div class="main-content">
        <h1 class="section-title">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ</h1>
        
        <!-- Ğ’Ñ‹Ğ±Ğ¾Ñ€ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹ -->
        <div class="mode-selection">
            <button id="singleModeBtn" class="mode-btn">
                <div class="mode-icon">ğŸ“±</div>
                <div class="mode-title">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒœáƒáƒ®áƒ•áƒ</div>
            </button>
            <button id="compareModeBtn" class="mode-btn">
                <div class="mode-icon">ğŸ”„</div>
                <div class="mode-title">áƒáƒ áƒ˜ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ</div>
            </button>
        </div>
        
        <!-- Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ¿Ñ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€Ğ° Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸Ğº Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ° -->
        <div id="singlePhoneModeContainer" style="display: none;">
            <div class="phone-selectors">
                <button id="selectSinglePhoneBtn" class="phone-selector-btn">
                    <div class="phone-thumb-container">
                        <div class="add-icon">+</div>
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</div>
                        <div class="phone-subtitle">áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¡áƒáƒœáƒáƒ®áƒáƒ•áƒáƒ“</div>
                    </div>
                </button>
            </div>
            
            <div id="singlePhoneSpecs" class="comparison-section"></div>
        </div>
        
        <!-- Ğ ĞµĞ¶Ğ¸Ğ¼ ÑÑ€Ğ°Ğ²Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ²ÑƒÑ… Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ² -->
        <div id="compareModeContainer" style="display: none;">
            <div class="phone-selectors">
                <button id="selectPhone1Btn" class="phone-selector-btn">
                    <div class="phone-thumb-container">
                        <div class="add-icon">+</div>
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</div>
                        <div class="phone-subtitle">áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ¨áƒ”áƒ¡áƒáƒ“áƒáƒ áƒ”áƒ‘áƒšáƒáƒ“ áƒ“áƒáƒ¡áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒšáƒáƒ“</div>
                    </div>
                </button>
                
                <div id="afterFirstSelected" style="display: none;">
                    <div id="secondSelectorContainer" class="second-selector-container">
                        <button id="selectPhone2Btn" class="phone-selector-btn">
                            <div class="phone-thumb-container">
                                <div class="add-icon">+</div>
                            </div>
                            <div class="phone-info-text">
                                <div class="phone-title">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ›áƒ”áƒáƒ áƒ” áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</div>
                                <div class="phone-subtitle">áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ¨áƒ”áƒ¡áƒáƒ“áƒáƒ áƒ”áƒ‘áƒšáƒáƒ“ áƒ“áƒáƒ¡áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒšáƒáƒ“</div>
                            </div>
                        </button>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="startComparisonBtn" class="btn-primary start-comparison-btn">
                        áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ¬áƒ§áƒ”áƒ‘áƒ
                    </button>
                </div>
            </div>
            
            <div id="comparisonResult" class="comparison-section">
                <div class="winner-display">
                    <div id="phone1Card" class="phone-card">
                        <img id="winnerImage" class="phone-thumb" src="" alt="áƒ’áƒáƒ›áƒáƒ áƒ¯áƒ•áƒ”áƒ‘áƒ£áƒšáƒ˜">
                        <h3 id="winnerName"></h3>
                        <div class="phone-percentage winner-percentage"></div>
                    </div>
                    
                    <div class="vs-circle">VS</div>
                    
                    <div id="phone2Card" class="phone-card">
                        <img id="loserImage" class="phone-thumb" src="" alt="áƒ“áƒáƒ›áƒáƒ áƒªáƒ®áƒ”áƒ‘áƒ£áƒšáƒ˜">
                        <h3 id="loserName"></h3>
                        <div class="phone-percentage loser-percentage"></div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3>áƒ«áƒ˜áƒ áƒ˜áƒ—áƒáƒ“áƒ˜ áƒ£áƒáƒ˜áƒ áƒáƒ¢áƒ”áƒ¡áƒáƒ‘áƒ”áƒ‘áƒ˜</h3>
                    </div>
                    <div class="card-body" id="winnerReason"></div>
                </div>
                
                <button id="showFullSpecsBtn" class="btn-primary">áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ</button>
                
                <div id="fullSpecs">
                    <!-- áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒ”áƒšáƒ˜ -->
                </div>
                
                <div class="ai-analysis card">
                    <div class="card-header">
                        <h3>AI áƒáƒœáƒáƒšáƒ˜áƒ–áƒ˜</h3>
                    </div>
                    <div class="card-body" id="aiAnalysisText"></div>
                    <div class="ai-icon">AI</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ĞœĞ¾Ğ´Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¾ĞºĞ½Ğ¾ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ² -->
    <div id="phoneSearchModal" class="result-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ”áƒ‘áƒ˜áƒ¡ áƒ«áƒ”áƒ‘áƒœáƒ</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="text" id="phoneSearchInput" class="form-control" placeholder="áƒ«áƒ”áƒ‘áƒœáƒ áƒ‘áƒ áƒ”áƒœáƒ“áƒ˜áƒ¡ áƒáƒœ áƒ›áƒáƒ“áƒ”áƒšáƒ˜áƒ¡ áƒ›áƒ˜áƒ®áƒ”áƒ“áƒ•áƒ˜áƒ—...">
                </div>
                <div id="searchResults"></div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            let selectedTarget = null;
            let phone1 = null;
            let phone2 = null;
            let singlePhone = null;
            
            // Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
            function getBrand(phone) {
                return phone.brand || phone.Ğ‘Ñ€ĞµĞ½Ğ´ || phone['Ğ‘Ñ€ĞµĞ½Ğ´'] || 'Unknown brand';
            }
            
            function getModel(phone) {
                return phone.model || phone.ĞœĞ¾Ğ´ĞµĞ»ÑŒ || phone['ĞœĞ¾Ğ´ĞµĞ»ÑŒ'] || 'Unknown model';
            }
            
            function getReleaseYear(phone) {
                return phone.release_year || phone['Ğ“Ğ¾Ğ´ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°'] || 'áƒáƒ  áƒáƒ áƒ˜áƒ¡ áƒ›áƒ˜áƒ—áƒ˜áƒ—áƒ”áƒ‘áƒ£áƒšáƒ˜';
            }
            
            function getImageUrl(phone) {
                return phone.image_url || phone.image || '/static/placeholder.jpg';
            }
            
            // Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ CSRF Ñ‚Ğ¾ĞºĞµĞ½Ğ° Ğ¸Ğ· cookies
            function getCSRFToken() {
                const cookies = document.cookie.split(';');
                for (let cookie of cookies) {
                    const [name, value] = cookie.trim().split('=');
                    if (name === 'csrf_token') {
                        return decodeURIComponent(value);
                    }
                }
                return null;
            }
            
            // ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° AJAX Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ CSRF Ñ‚Ğ¾ĞºĞµĞ½Ğ°
            $.ajaxSetup({
                beforeSend: function(xhr, settings) {
                    if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type)) {
                        const csrfToken = getCSRFToken();
                        if (csrfToken) {
                            xhr.setRequestHeader('X-CSRFToken', csrfToken);
                        }
                    }
                }
            });
            
            // Ğ ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
            function setupEventHandlers() {
                // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¾Ğ²
                $('#singleModeBtn').on('click', function() {
                    $('.mode-selection').hide();
                    $('#singlePhoneModeContainer').show();
                    $('#compareModeContainer').hide();
                    resetComparisonState();
                });
                
                $('#compareModeBtn').on('click', function() {
                    $('.mode-selection').hide();
                    $('#compareModeContainer').show();
                    $('#singlePhoneModeContainer').hide();
                    resetComparisonState();
                });
                
                // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ ĞºĞ½Ğ¾Ğ¿Ğ¾Ğº Ğ²Ñ‹Ğ±Ğ¾Ñ€Ğ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ²
                $('#selectSinglePhoneBtn, #selectPhone1Btn, #selectPhone2Btn').on('click', handlePhoneSelectorClick);
                $('.close-modal').on('click', closeModal);
                $('#showFullSpecsBtn').on('click', toggleFullSpecs);
                $('#startComparisonBtn').on('click', comparePhones);
                
                // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ Ğ´Ğ»Ñ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ²
                $(document).on('click', '.retry-btn', handleRetryClick);
                $(document).on('click', '.phone-search-result', handleSearchResultClick);
                $(document).on('click', '#retryComparisonBtn', handleRetryComparison);
                $(document).on('click', '#phoneSearchModal', handleModalBackgroundClick);
                
                // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ²Ğ²Ğ¾Ğ´Ğ° Ğ² Ğ¿Ğ¾Ğ»Ğµ Ğ¿Ğ¾Ğ¸ÑĞºĞ°
                $('#phoneSearchInput').on('keyup', handleSearchInput);
            }
            
            function resetComparisonState() {
                phone1 = null;
                phone2 = null;
                singlePhone = null;
                
                // Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ UI
                $('#selectPhone1Btn').html(`
                    <div class="phone-thumb-container">
                        <div class="add-icon">+</div>
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</div>
                        <div class="phone-subtitle">áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ¨áƒ”áƒ¡áƒáƒ“áƒáƒ áƒ”áƒ‘áƒšáƒáƒ“ áƒ“áƒáƒ¡áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒšáƒáƒ“</div>
                    </div>
                `);
                
                $('#selectPhone2Btn').html(`
                    <div class="phone-thumb-container">
                        <div class="add-icon">+</div>
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ›áƒ”áƒáƒ áƒ” áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜</div>
                        <div class="phone-subtitle">áƒ“áƒáƒáƒ¬áƒ™áƒáƒáƒ£áƒœáƒ”áƒ— áƒ¨áƒ”áƒ¡áƒáƒ“áƒáƒ áƒ”áƒ‘áƒšáƒáƒ“ áƒ“áƒáƒ¡áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒšáƒáƒ“</div>
                    </div>
                `);
                
                $('#afterFirstSelected').hide();
                $('#startComparisonBtn').hide();
                $('#comparisonResult').hide();
            }
            
            // ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
            function handlePhoneSelectorClick() {
                selectedTarget = $(this).attr('id').replace('Btn', '');
                let modeText = '';
                
                if (selectedTarget === 'selectSinglePhone') {
                    modeText = 'áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡';
                } else if (selectedTarget === 'selectPhone1') {
                    modeText = 'áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜';
                } else {
                    modeText = 'áƒ›áƒ”áƒáƒ áƒ”';
                }
                
                $('.modal-title').text('áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— ' + modeText + ' áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜');
                $('#phoneSearchModal').css('display', 'flex');
                $('#phoneSearchInput').val('').focus();
                $('#searchResults').html('');
            }
            
            function closeModal() {
                $('#phoneSearchModal').hide();
            }
            
            function handleModalBackgroundClick(event) {
                if ($(event.target).hasClass('result-modal')) {
                    $('#phoneSearchModal').hide();
                }
            }
            
            function handleSearchInput() {
                const query = $(this).val();
                if (query.length < 2) {
                    $('#searchResults').html('');
                    return;
                }
                
                // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
                $('#searchResults').html(`
                    <div style="text-align: center; padding: 30px;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 15px;">áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ”áƒáƒ‘áƒ¡ áƒ«áƒ”áƒ‘áƒœáƒ...</p>
                    </div>
                `);
                
                // Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğº API Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ¸ÑĞºĞ° Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ¾Ğ²
                $.ajax({
                    url: '/api/search_phones',
                    type: 'GET',
                    data: { query: query },
                    success: function(data) {
                        renderSearchResults(data);
                    },
                    error: renderSearchError
                });
            }
            
            function handleSearchResultClick() {
                const phoneId = $(this).data('id');
                selectPhone(phoneId);
            }
            
            function handleRetryClick() {
                const target = $(this).data('target');
                retryLoadPhone(target);
            }
            
            function handleRetryComparison() {
                comparePhones();
            }
            
            function toggleFullSpecs() {
                $('#fullSpecs').slideToggle();
                $(this).text(function(i, text) {
                    return text === "áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ" 
                           ? "áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒšáƒ•áƒ" 
                           : "áƒ§áƒ•áƒ”áƒšáƒ áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ˜áƒ¡ áƒ©áƒ•áƒ”áƒœáƒ”áƒ‘áƒ";
                });
            }
            
            // Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸
            function renderSearchResults(data) {
                let html = '';
                if (data.length > 0) {
                    data.forEach(phone => {
                        const brand = getBrand(phone);
                        const model = getModel(phone);
                        const releaseYear = getReleaseYear(phone);
                        
                        html += `
                            <div class="phone-search-result" data-id="${phone._id}">
                                <img src="${getImageUrl(phone)}" alt="${brand} ${model}">
                                <div class="phone-search-info">
                                    <div class="phone-search-name">${brand} ${model}</div>
                                    <div class="phone-search-details">áƒ’áƒáƒ›áƒáƒ¨áƒ•áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒ”áƒšáƒ˜: ${releaseYear}</div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    html = '<div class="phone-search-result" style="justify-content: center; padding: 30px;">áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</div>';
                }
                $('#searchResults').html(html);
            }
            
            function renderSearchError() {
                $('#searchResults').html(`
                    <div class="error-message">
                        áƒ«áƒ”áƒ‘áƒœáƒ˜áƒ¡ áƒáƒ áƒáƒªáƒ”áƒ¡áƒ¨áƒ˜ áƒ›áƒáƒ®áƒ“áƒ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ
                        <button class="retry-btn search-retry-btn">áƒ®áƒ”áƒšáƒáƒ®áƒšáƒ áƒªáƒ“áƒ</button>
                    </div>
                `);
            }
            
            function selectPhone(phoneId) {
                showLoading(selectedTarget);
                
                // Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´ĞµÑ‚Ğ°Ğ»ĞµĞ¹ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°
                $.ajax({
                    url: '/api/phone_details',
                    type: 'GET',
                    data: { id: phoneId },
                    success: function(phone) {
                        updatePhoneSelection(phone);
                        $('#phoneSearchModal').hide();
                        
                        // Ğ”Ğ»Ñ Ğ¾Ğ´Ğ¸Ğ½Ğ¾Ñ‡Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ğ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
                        if (selectedTarget === 'selectSinglePhone') {
                            showSinglePhoneSpecs(phone);
                        }
                    },
                    error: function() {
                        showError(selectedTarget, 'áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ');
                    }
                });
            }
            
            function updatePhoneSelection(phone) {
                if (selectedTarget === 'selectSinglePhone') {
                    singlePhone = phone;
                    updatePhoneDisplay(phone, '#selectSinglePhoneBtn');
                } 
                else if (selectedTarget === 'selectPhone1') {
                    phone1 = phone;
                    updatePhoneDisplay(phone, '#selectPhone1Btn');
                    showAfterFirstSelected();
                } else {
                    phone2 = phone;
                    updatePhoneDisplay(phone, '#selectPhone2Btn');
                    showComparisonButton();
                }
            }
            
            function showLoading(target) {
                const btnSelector = `#${target}Btn`;
                $(btnSelector).html(`
                    <div class="phone-thumb-container">
                        <div class="loading-spinner"></div>
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</div>
                        <div class="phone-subtitle">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ“áƒáƒ˜áƒªáƒáƒ“áƒáƒ—</div>
                    </div>
                `);
            }
            
            function showError(target, message) {
                const btnSelector = `#${target}Btn`;
                $(btnSelector).html(`
                    <div class="phone-thumb-container">
                        <div style="font-size: 1.5rem; color: var(--error-color);">!</div>
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title" style="color: var(--error-color);">áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ</div>
                        <div class="phone-subtitle">${message}</div>
                        <button class="retry-btn" data-target="${target}">áƒ®áƒ”áƒšáƒáƒ®áƒšáƒ áƒªáƒ“áƒ</button>
                    </div>
                `);
            }
            
            function updatePhoneDisplay(phone, btnSelector) {
                const brand = getBrand(phone);
                const model = getModel(phone);
                const releaseYear = getReleaseYear(phone);
                const imageUrl = getImageUrl(phone);
                
                $(btnSelector).html(`
                    <div class="phone-thumb-container">
                        <img src="${imageUrl}" alt="${brand} ${model}" style="max-width: 100%; max-height: 100%;">
                    </div>
                    <div class="phone-info-text">
                        <div class="phone-title">${brand} ${model}</div>
                        <div class="phone-subtitle">áƒ’áƒáƒ›áƒáƒ¨áƒ•áƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒ”áƒšáƒ˜: ${releaseYear}</div>
                    </div>
                `);
                
                $(btnSelector).css({
                    transform: 'scale(0.95)',
                    border: '2px solid rgba(0, 198, 255, 0.5)'
                });
                
                setTimeout(function() {
                    $(btnSelector).css({
                        transform: 'scale(1)',
                        border: '1px solid rgba(0, 198, 255, 0.3)'
                    });
                }, 300);
            }
            
            function showAfterFirstSelected() {
                $('#afterFirstSelected').show();
                $('#secondSelectorContainer').show();
                $('#startComparisonBtn').hide();
            }
            
            function showComparisonButton() {
                $('#afterFirstSelected').show(); // Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾: Ğ½Ğµ ÑĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ¾Ğ½Ñ‚ĞµĞ¹Ğ½ĞµÑ€
                $('#startComparisonBtn').show();
            }
            
            // ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞ»ĞµÑ„Ğ¾Ğ½Ğ°
            function showSinglePhoneSpecs(phone) {
                const brand = getBrand(phone);
                const model = getModel(phone);
                const imageUrl = getImageUrl(phone);
                
                // Ğ¤Ğ¸Ğ»ÑŒÑ‚Ñ€ÑƒĞµĞ¼ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
                const technicalSpecs = Object.entries(phone)
                    .filter(([key]) => !['_id', 'image_url', 'image', 'brand', 'model', 'release_year', 'Ğ‘Ñ€ĞµĞ½Ğ´', 'ĞœĞ¾Ğ´ĞµĞ»ÑŒ', 'Ğ“Ğ¾Ğ´ Ğ²Ñ‹Ğ¿ÑƒÑĞºĞ°'].includes(key))
                    .map(([key, value]) => ({
                        key: key,
                        value: value || '-'
                    }));
                
                $('#singlePhoneSpecs').show().html(`
                    <div class="card">
                        <div class="card-header">
                            <h3>${brand} ${model} - áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜</h3>
                        </div>
                        <div class="card-body">
                            <img src="${imageUrl}" 
                                 class="phone-thumb" 
                                 style="margin: 0 auto 30px; display: block;">
                            <div class="specs-container">
                                <table class="specs-table">
                                    <thead>
                                        <tr>
                                            <th>áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒ”áƒšáƒ˜</th>
                                            <th>áƒ›áƒœáƒ˜áƒ¨áƒ•áƒœáƒ”áƒšáƒáƒ‘áƒ</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${technicalSpecs.map(spec => `
                                            <tr>
                                                <td>${spec.key}</td>
                                                <td>${spec.value}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `);
                
                $('#comparisonResult').hide();
            }
            
            function comparePhones() {
                if (!phone1 || !phone2) {
                    showErrorNotification('áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒáƒ˜áƒ áƒ©áƒ˜áƒáƒ— áƒáƒ áƒ˜áƒ•áƒ” áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜ áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡');
                    return;
                }
                
                $('#comparisonResult').html(`
                    <div style="text-align: center; padding: 50px;">
                        <div class="loading-spinner" style="width: 50px; height: 50px;"></div>
                        <p style="margin-top: 20px; font-size: 1.2rem;">áƒ›áƒ˜áƒ›áƒ“áƒ˜áƒœáƒáƒ áƒ”áƒáƒ‘áƒ¡ áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ...</p>
                    </div>
                `).show();
                
                // Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ğ¾Ğµ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ĞµĞ½Ğ¸Ğµ ID
                const getPhoneId = (phone) => {
                    if (phone._id && phone._id.$oid) {
                        return phone._id.$oid;
                    }
                    return phone._id;
                };
                
                const phone1Id = getPhoneId(phone1);
                const phone2Id = getPhoneId(phone2);
                
                // Ğ˜ÑĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ´Ğ»Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ°
                $.ajax({
                    url: '/api/compare',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        phone1_id: phone1Id,
                        phone2_id: phone2Id
                    }),
                    success: function(result) {
                        displayComparisonResult(result);
                    },
                    error: function(xhr) {
                        let errorMsg = `áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒáƒ áƒáƒªáƒ”áƒ¡áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ (${xhr.status} ${xhr.statusText})`;
                        try {
                            const response = JSON.parse(xhr.responseText);
                            if (response.error) {
                                errorMsg = response.error;
                            } else if (response.message) {
                                errorMsg = response.message;
                            }
                        } catch (e) {
                            errorMsg = xhr.responseText || errorMsg;
                        }
                        console.error("Comparison error:", errorMsg, xhr);
                        $('#comparisonResult').html(`
                            <div class="error-message" style="margin: 30px;">
                                ${errorMsg}
                                <button class="retry-btn" id="retryComparisonBtn">áƒ®áƒ”áƒšáƒáƒ®áƒšáƒ áƒªáƒ“áƒ</button>
                            </div>
                        `);
                    }
                });
                
                $('#singlePhoneSpecs').hide();
            }
            
            function displayComparisonResult(result) {
                // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ñ Ğ½ĞµĞ¾Ğ±Ñ…Ğ¾Ğ´Ğ¸Ğ¼Ñ‹Ñ… Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
                if (!result || !result.phone1 || !result.phone2) {
                    $('#comparisonResult').html(`
                        <div class="error-message" style="margin: 30px;">
                            áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ”áƒ‘áƒ˜ áƒáƒ áƒáƒ¡áƒ¬áƒáƒ áƒ˜áƒ
                            <button class="retry-btn" id="retryComparisonBtn">áƒ®áƒ”áƒšáƒáƒ®áƒšáƒ áƒªáƒ“áƒ</button>
                        </div>
                    `);
                    return;
                }
                
                const brand1 = getBrand(result.phone1);
                const model1 = getModel(result.phone1);
                const brand2 = getBrand(result.phone2);
                const model2 = getModel(result.phone2);
                
                const winner = result.overall_winner === 'phone1' ? result.phone1 : result.phone2;
                const loser = result.overall_winner === 'phone1' ? result.phone2 : result.phone1;
                
                const winnerBrand = getBrand(winner);
                const winnerModel = getModel(winner);
                const loserBrand = getBrand(loser);
                const loserModel = getModel(loser);
                
                $('#winnerImage').attr('src', getImageUrl(winner));
                $('#winnerName').text(`${winnerBrand} ${winnerModel}`);
                $('.winner-percentage').text(`${result.percent_phone1}%`);
                
                $('#loserImage').attr('src', getImageUrl(loser));
                $('#loserName').text(`${loserBrand} ${loserModel}`);
                $('.loser-percentage').text(`${result.percent_phone2}%`);
                
                $(`#phone1Card`).toggleClass('winner', result.overall_winner === 'phone1');
                $(`#phone2Card`).toggleClass('winner', result.overall_winner === 'phone2');
                
                // ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€ĞµĞ¸Ğ¼ÑƒÑ‰ĞµÑÑ‚Ğ²
                let advantagesHtml = '';
                if (result.comparison && result.comparison.length > 0) {
                    result.comparison.forEach(category => {
                        if (category.category_percent_phone1 !== category.category_percent_phone2) {
                            const winnerPercent = Math.max(category.category_percent_phone1, category.category_percent_phone2);
                            const loserPercent = Math.min(category.category_percent_phone1, category.category_percent_phone2);
                            const winnerPhone = category.category_percent_phone1 > category.category_percent_phone2 ? 
                                                model1 : model2;
                            
                            advantagesHtml += `
                                <div class="advantage-item">
                                    <div class="advantage-header">
                                        <strong>${category.category}</strong>
                                        <span style="color: var(--success-color);">${winnerPercent}%</span>
                                    </div>
                                    <div class="advantage-details">
                                        <span>${winnerPhone} áƒ£áƒ™áƒ”áƒ—áƒ”áƒ¡áƒ˜áƒ ${(winnerPercent - loserPercent).toFixed(1)}%-áƒ˜áƒ—</span>
                                        <span>${loserPercent}%</span>
                                    </div>
                                </div>
                            `;
                        }
                    });
                }
                
                $('#winnerReason').html(advantagesHtml || '<p>áƒ£áƒáƒ˜áƒ áƒáƒ¢áƒ”áƒ¡áƒáƒ‘áƒ”áƒ‘áƒ˜ áƒáƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</p>');
                
                // ĞÑ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğµ Ğ²ÑĞµÑ… Ñ…Ğ°Ñ€Ğ°ĞºÑ‚ĞµÑ€Ğ¸ÑÑ‚Ğ¸Ğº
                let fullSpecsHtml = '';
                if (result.comparison && result.comparison.length > 0) {
                    result.comparison.forEach(category => {
                        fullSpecsHtml += `
                            <div class="spec-group">
                                <div class="card-header">
                                    <h4>${category.category}</h4>
                                </div>
                                <div class="card-body">
                                    <div class="specs-container">
                                        <table class="specs-table">
                                            <thead>
                                                <tr>
                                                    <th style="width: 30%;">áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒ”áƒšáƒ˜</th>
                                                    <th style="width: 35%;">${brand1}</th>
                                                    <th style="width: 35%;">${brand2}</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                        `;
                        
                        if (category.specs && category.specs.length > 0) {
                            category.specs.forEach(spec => {
                                const isPhone1Winner = spec.winner === 'phone1';
                                const isPhone2Winner = spec.winner === 'phone2';
                                
                                fullSpecsHtml += `
                                    <tr>
                                        <td>${spec.name}</td>
                                        <td class="${isPhone1Winner ? 'winner-value' : ''}">${spec.phone1_value || '-'}</td>
                                        <td class="${isPhone2Winner ? 'winner-value' : ''}">${spec.phone2_value || '-'}</td>
                                    </tr>
                                `;
                            });
                        } else {
                            fullSpecsHtml += `
                                <tr>
                                    <td colspan="3" style="text-align: center; color: var(--text-secondary);">áƒ›áƒáƒ®áƒáƒ¡áƒ˜áƒáƒ—áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜ áƒáƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</td>
                                </tr>
                            `;
                        }
                        
                        fullSpecsHtml += `
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                } else {
                    fullSpecsHtml = '<div class="error-message">áƒ¨áƒ”áƒ“áƒáƒ áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒœáƒáƒªáƒ”áƒ›áƒ”áƒ‘áƒ˜ áƒ•áƒ”áƒ  áƒ›áƒáƒ˜áƒ«áƒ”áƒ‘áƒœáƒ</div>';
                }
                
                $('#fullSpecs').html(fullSpecsHtml);
                
                // AI Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·
                $('#aiAnalysisText').html(result.ai_analysis || "<p>AI áƒáƒœáƒáƒšáƒ˜áƒ–áƒ˜ áƒ®áƒ”áƒšáƒ›áƒ˜áƒ£áƒ¬áƒ•áƒ“áƒáƒ›áƒ”áƒšáƒ˜áƒ</p>");
                
                $('#singlePhoneSpecs').hide();
                $('#comparisonResult').show();
            }
            
            function retryLoadPhone(target) {
                const phoneId = target === 'selectPhone1' ? (phone1 && phone1._id) : (phone2 && phone2._id);
                if (phoneId) {
                    $(`#${target}Btn`).html(`
                        <div class="phone-thumb-container">
                            <div class="loading-spinner"></div>
                        </div>
                        <div class="phone-info-text">
                            <div class="phone-title">áƒ˜áƒ¢áƒ•áƒ˜áƒ áƒ—áƒ”áƒ‘áƒ...</div>
                            <div class="phone-subtitle">áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒ“áƒáƒ˜áƒªáƒáƒ“áƒáƒ—</div>
                        </div>
                    `);
                    
                    $.ajax({
                        url: '/api/phone_details',
                        type: 'GET',
                        data: { id: phoneId },
                        success: function(phone) {
                            updatePhoneSelection(phone);
                        },
                        error: function() {
                            showError(target, 'áƒ¢áƒ”áƒšáƒ”áƒ¤áƒáƒœáƒ˜áƒ¡ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ˜áƒ¡ áƒ©áƒáƒ¢áƒ•áƒ˜áƒ áƒ—áƒ•áƒ áƒ•áƒ”áƒ  áƒ›áƒáƒ®áƒ”áƒ áƒ®áƒ“áƒ');
                        }
                    });
                } else {
                    $(`#${target}Btn`).click();
                }
            }
            
            function showErrorNotification(message) {
                const notification = $(`
                    <div class="notification error-notification">
                        ${message}
                    </div>
                `);
                
                $('body').append(notification);
                
                setTimeout(() => {
                    notification.fadeOut(500, () => notification.remove());
                }, 5000);
            }
            
            // Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸ĞºĞ¾Ğ² ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹
            setupEventHandlers();
        });
    </script>
</body>
    </html>
